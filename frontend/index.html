<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Healthcare App - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: "Roboto", sans-serif;
      margin: 0;
      background: linear-gradient(to bottom, #e6f2ff, #f9fbfd);
      color: #333;
    }

    header {
      background: #0077b6;
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      font-size: 24px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header img {
      height: 40px;
    }

    header button {
      background: #d62828;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.2s;
    }

    header button:hover {
      opacity: 0.85;
    }

    .hero {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      margin: 20px auto;
      padding: 30px;
      border-radius: 12px;
      max-width: 1000px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .hero-text {
      max-width: 60%;
    }

    .hero-text h1 {
      color: #023e8a;
      font-size: 32px;
      margin-bottom: 10px;
    }

    .hero-text p {
      font-size: 16px;
      color: #555;
    }

    .hero img {
      max-width: 300px;
      border-radius: 12px;
    }

    .container {
      max-width: 1000px;
      margin: 30px auto;
      padding: 20px;
    }

    h2 {
      color: #023e8a;
      margin-bottom: 10px;
    }

    .card {
      background: white;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    input {
      padding: 10px;
      margin: 5px;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 220px;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.add {
      background: #2d9e3f;
      color: white;
    }

    button.update {
      background: #0077b6;
      color: white;
    }

    button.delete {
      background: #d62828;
      color: white;
    }

    button:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    #message {
      margin: 10px 0;
      font-weight: 600;
    }

    #loading {
      display: none;
      font-style: italic;
      color: gray;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }

    th, td {
      border: 1px solid #e0e0e0;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #0077b6;
      color: white;
      font-weight: 600;
    }

    tr:hover {
      background: #f1f9ff;
    }

    .search-box input {
      width: 300px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <header>
    <h1><img src="https://cdn-icons-png.flaticon.com/512/2966/2966482.png" alt="logo"> Healthcare App</h1>
    <button onclick="logout()">üö™ Logout</button>
  </header>

  <!-- Hero Banner -->
  <div class="hero">
    <div class="hero-text">
      <h1>Manage Patient Records with Ease üè•</h1>
      <p>Track conditions, medical history, and care plans in a secure dashboard designed for clinicians.</p>
    </div>
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUSJOTS3FoAwrMDyjjpJoCecr857y9gx9-qA&s" alt="Healthcare">
  </div>

  <div class="container">
    <!-- Success/Error Message -->
    <div id="message"></div>

    <!-- Add / Update Patient Form -->
    <div class="card">
      <h2><i class="fa-solid fa-user-plus"></i> Add / Edit Patient</h2>
      <input type="text" id="name" placeholder="Patient Name">
      <input type="number" id="age" placeholder="Age">
      <input type="text" id="condition" placeholder="Condition">
      <input type="text" id="medicalHistory" placeholder="Medical History">
      <input type="text" id="carePlan" placeholder="Care Plan">
      <button class="add" onclick="addPatient()"><i class="fa-solid fa-plus"></i> Add</button>
    </div>

    <!-- Search Bar -->
    <div class="card">
      <h2><i class="fa-solid fa-magnifying-glass"></i> Search Patients</h2>
      <div class="search-box">
        <input type="text" id="searchBox" placeholder="üîç Search by name..." onkeyup="filterPatients()">
      </div>
    </div>

    <!-- Patients Table -->
    <div class="card">
      <h2><i class="fa-solid fa-list"></i> Patients List</h2>
      <p id="loading">Loading...</p>
      <table>
        <thead>
          <tr>
            <th>üë§ Name</th>
            <th>üéÇ Age</th>
            <th>ü©∫ Condition</th>
            <th>üìú Medical History</th>
            <th>üíä Care Plan</th>
            <th>‚öôÔ∏è Actions</th>
          </tr>
        </thead>
        <tbody id="patientsTable"></tbody>
      </table>
    </div>
  </div>
  <script>
    // üîí Authentication Check
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "login.html";
    }
  
    // üåê Replace with your actual Render backend URL
    const API_URL = "https://healthcare-app-2025-ta9n.onrender.com/patients";
  
    let allPatients = [];
  
    function logout() {
      localStorage.removeItem("token");
      window.location.href = "login.html";
    }
  
    function showMessage(text, success = true) {
      const msgBox = document.getElementById("message");
      msgBox.innerText = text;
      msgBox.style.color = success ? "green" : "red";
      setTimeout(() => msgBox.innerText = "", 3000);
    }
  
    // üìå Fetch Patients
    async function fetchPatients() {
      document.getElementById("loading").style.display = "block";
      try {
        const res = await fetch(API_URL, {
          headers: { "Authorization": "Bearer " + token }
        });
  
        if (res.status === 401) {
          logout();
          return;
        }
  
        allPatients = await res.json();
        displayPatients(allPatients);
      } catch (err) {
        showMessage("Error fetching patients", false);
      }
      document.getElementById("loading").style.display = "none";
    }
  
    // üìå Display Patients
    function displayPatients(patients) {
      document.getElementById("patientsTable").innerHTML = patients.map(p => `
        <tr>
          <td>${p.name}</td>
          <td>${p.age}</td>
          <td>${p.condition || ""}</td>
          <td>${p.medicalHistory || ""}</td>
          <td>${p.carePlan || ""}</td>
          <td>
            <button class="update" onclick="editPatient('${p._id}', '${p.name}', ${p.age}, '${p.condition || ""}', '${p.medicalHistory || ""}', '${p.carePlan || ""}', event)">
              <i class="fa-solid fa-pen"></i> Edit
            </button>
            <button class="delete" onclick="deletePatient('${p._id}')">
              <i class="fa-solid fa-trash"></i> Delete
            </button>
          </td>
        </tr>
      `).join("");
    }
  
    // üìå Search Patients
    function filterPatients() {
      const searchValue = document.getElementById("searchBox").value.toLowerCase();
      const filtered = allPatients.filter(p => p.name.toLowerCase().includes(searchValue));
      displayPatients(filtered);
    }
  
    // üìå Add Patient
    async function addPatient() {
      const name = document.getElementById("name").value.trim();
      const age = document.getElementById("age").value.trim();
      const condition = document.getElementById("condition").value.trim();
      const medicalHistory = document.getElementById("medicalHistory").value.trim();
      const carePlan = document.getElementById("carePlan").value.trim();
  
      if (!name || !age || !condition) {
        showMessage("Please fill all required fields", false);
        return;
      }
  
      const patient = { name, age, condition, medicalHistory, carePlan };
  
      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { 
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify(patient)
        });
  
        if (!res.ok) throw new Error();
  
        showMessage("‚úÖ Patient added successfully!");
        clearForm();
        fetchPatients();
      } catch {
        showMessage("‚ùå Failed to add patient", false);
      }
    }
  
    // üìå Delete Patient
    async function deletePatient(id) {
      if (!confirm("Are you sure you want to delete this patient?")) return;
      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "DELETE",
          headers: { "Authorization": "Bearer " + token }
        });
  
        if (!res.ok) throw new Error();
        showMessage("Patient deleted successfully!");
        fetchPatients();
      } catch {
        showMessage("‚ùå Failed to delete patient", false);
      }
    }
  
    // üìå Edit Patient
    function editPatient(id, name, age, condition, medicalHistory, carePlan, event) {
      document.getElementById("name").value = name;
      document.getElementById("age").value = age;
      document.getElementById("condition").value = condition;
      document.getElementById("medicalHistory").value = medicalHistory;
      document.getElementById("carePlan").value = carePlan;
  
      document.querySelectorAll("#patientsTable tr").forEach(r => r.style.background = "");
      event.target.closest("tr").style.background = "#fff3cd";
  
      const btn = document.querySelector("button.add");
      btn.innerText = "üíæ Update";
      btn.className = "update";
      btn.setAttribute("onclick", `updatePatient('${id}')`);
    }
  
    // üìå Update Patient
    async function updatePatient(id) {
      const name = document.getElementById("name").value.trim();
      const age = document.getElementById("age").value.trim();
      const condition = document.getElementById("condition").value.trim();
      const medicalHistory = document.getElementById("medicalHistory").value.trim();
      const carePlan = document.getElementById("carePlan").value.trim();
  
      if (!name || !age || !condition) {
        showMessage("Please fill all required fields", false);
        return;
      }
  
      const updatedPatient = { name, age, condition, medicalHistory, carePlan };
  
      try {
        const res = await fetch(`${API_URL}/${id}`, {
          method: "PUT",
          headers: { 
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify(updatedPatient)
        });
  
        if (!res.ok) throw new Error();
  
        showMessage("Patient updated successfully!");
        clearForm();
        fetchPatients();
      } catch {
        showMessage("‚ùå Failed to update patient", false);
      }
  
      const btn = document.querySelector("button.update");
      btn.innerText = "‚ûï Add";
      btn.className = "add";
      btn.setAttribute("onclick", "addPatient()");
    }
  
    // üìå Clear Form
    function clearForm() {
      document.getElementById("name").value = "";
      document.getElementById("age").value = "";
      document.getElementById("condition").value = "";
      document.getElementById("medicalHistory").value = "";
      document.getElementById("carePlan").value = "";
      document.getElementById("name").focus();
    }
  
    // üöÄ Load patients on page load
    fetchPatients();
  </script>
  
</body>
</html>
